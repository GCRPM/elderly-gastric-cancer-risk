<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>老年人胃癌风险网页计算器</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="bg-gray-100 flex items-center justify-center min-h-screen">
        <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-4xl flex">
            <!-- 左侧：输入表单 -->
            <div class="w-1/2 pr-4 border-r">
                <h1 class="text-2xl font-bold mb-4 text-center">老年人胃癌风险网页计算器</h1>
                <form id="risk-form" class="space-y-4">
                    <!-- Input fields for each variable -->
                    <div>
                        <label for="gender" class="block text-sm font-medium text-gray-700">性别</label>
                        <select id="gender" name="gender" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="" selected>请选择</option>
                            <option value="0">女</option>
                            <option value="1">男</option>
                        </select>
                    </div>
                    <div>
                        <label for="age" class="block text-sm font-medium text-gray-700">年龄</label>
                        <select id="age" name="age" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="" selected>请选择</option>
                            <option value="0">60～69</option>
                            <option value="1">70～79</option>
                            <option value="2">80及以上</option>
                        </select>
                    </div>
                    <div>
                        <label for="personality" class="block text-sm font-medium text-gray-700">性格类型</label>
                        <select id="personality" name="personality" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="" selected>请选择</option>
                            <option value="0">非A型性格</option>
                            <option value="1">A型性格</option>
                        </select>
                    </div>
                    <div>
                        <label for="salt" class="block text-sm font-medium text-gray-700">食盐＞5g摄入频率</label>
                        <select id="salt" name="salt" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="" selected>请选择</option>
                            <option value="0">几乎从不</option>
                            <option value="1">每周1～3次</option>
                            <option value="2">每周4～6次</option>
                            <option value="3">每天</option>
                        </select>
                    </div>
                    <div>
                        <label for="pickled" class="block text-sm font-medium text-gray-700">腌制食品摄入频率</label>
                        <select id="pickled" name="pickled" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="" selected>请选择</option>
                            <option value="0">几乎从不</option>
                            <option value="1">每周1～3次</option>
                            <option value="2">每周4～6次</option>
                            <option value="3">每天</option>
                        </select>
                    </div>
                    <div>
                        <label for="leftovers" class="block text-sm font-medium text-gray-700">是否吃剩饭菜</label>
                        <select id="leftovers" name="leftovers" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="" selected>请选择</option>
                            <option value="0">几乎从不</option>
                            <option value="1">每周1～3次</option>
                            <option value="2">每周4～6次</option>
                            <option value="3">每天</option>
                        </select>
                    </div>
                    <div>
                        <label for="vegetables" class="block text-sm font-medium text-gray-700">新鲜蔬菜摄入频率</label>
                        <select id="vegetables" name="vegetables" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="" selected>请选择</option>
                            <option value="0">几乎从不</option>
                            <option value="1">每周1～3次</option>
                            <option value="2">每周4～6次</option>
                            <option value="3">每天</option>
                        </select>
                    </div>
                    <div>
                        <label for="anxiety" class="block text-sm font-medium text-gray-700">焦虑程度</label>
                        <select id="anxiety" name="anxiety" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="" selected>请选择</option>
                            <option value="0">无</option>
                            <option value="1">轻度</option>
                            <option value="2">中度</option>
                            <option value="3">重度</option>
                        </select>
                    </div>
                    <div>
                        <label for="depression" class="block text-sm font-medium text-gray-700">抑郁程度</label>
                        <select id="depression" name="depression" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="" selected>请选择</option>
                            <option value="0">无</option>
                            <option value="1">轻度</option>
                            <option value="2">中度</option>
                            <option value="3">重度</option>
                        </select>
                    </div>
                    <div>
                        <label for="gastric_disease" class="block text-sm font-medium text-gray-700">胃部疾病史</label>
                        <select id="gastric_disease" name="gastric_disease" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="" selected>请选择</option>
                            <option value="0">无</option>
                            <option value="1">有</option>
                        </select>
                    </div>
                    <div>
                        <label for="family_history" class="block text-sm font-medium text-gray-700">一级亲属胃癌家族史</label>
                        <select id="family_history" name="family_history" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="" selected>请选择</option>
                            <option value="0">无</option>
                            <option value="1">有</option>
                        </select>
                    </div>
                    <button type="button" id="calculate-btn" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700">计算风险</button>
                </form>
            </div>

            <!-- 右侧：结果展示 -->
            <div class="w-1/2 pl-4 flex flex-col items-center justify-center">
                <h2 class="text-xl font-bold mb-4">风险概率结果</h2>
                <div class="w-full h-6 bg-gray-200 rounded-full relative">
                    <!-- 低风险区域 -->
                    <div class="absolute top-0 left-0 h-full bg-green-500 rounded-l-full" style="width: 30%;"></div>
                    <!-- 中风险区域 -->
                    <div class="absolute top-0 left-[30%] h-full bg-yellow-500" style="width: 18.7%;"></div>
                    <!-- 高风险区域 -->
                    <div class="absolute top-0 left-[48.7%] h-full bg-red-500 rounded-r-full" style="width: 51.3%;"></div>
                    <!-- 预测点 -->
                    <div id="risk-point" class="absolute top-0 h-6 w-6 bg-blue-500 rounded-full border-2 border-white" style="transform: translateX(-50%);"></div>
                </div>
                <p id="risk-text" class="mt-4 text-lg font-semibold text-gray-700"></p>
            </div>
        </div>

        <script>
            document.getElementById('calculate-btn').addEventListener('click', function () {
                // 获取用户输入
                const gender = document.getElementById('gender').value;
                const age = document.getElementById('age').value;
                const personality = document.getElementById('personality').value;
                const salt = document.getElementById('salt').value;
                const pickled = document.getElementById('pickled').value;
                const leftovers = document.getElementById('leftovers').value;
                const vegetables = document.getElementById('vegetables').value;
                const anxiety = document.getElementById('anxiety').value;
                const depression = document.getElementById('depression').value;
                const gastric_disease = document.getElementById('gastric_disease').value;
                const family_history = document.getElementById('family_history').value;

                // 检查是否有未选择的变量
                if (!gender || !age || !personality || !salt || !pickled || !leftovers || !vegetables || !anxiety || !depression || !gastric_disease || !family_history) {
                    document.getElementById('risk-text').innerHTML = `<p class="text-red-500">请填写所有选项后再计算。</p>`;
                    return;
                }

                // Logistic regression formula (logit(P))
                const logit = -2.619 
                    + 1.123 * parseFloat(gender) 
                    + 0.748 * parseFloat(age) 
                    + 0.402 * parseFloat(personality) 
                    + 0.766 * (parseFloat(salt) === 1 ? 1 : 0) 
                    + 0.790 * (parseFloat(salt) === 3 ? 1 : 0) 
                    + 0.571 * (parseFloat(pickled) === 1 ? 1 : 0) 
                    + 0.936 * (parseFloat(pickled) === 2 ? 1 : 0) 
                    + 1.122 * (parseFloat(pickled) === 3 ? 1 : 0) 
                    + 0.863 * (parseFloat(leftovers) === 1 ? 1 : 0) 
                    + 0.945 * (parseFloat(leftovers) === 2 ? 1 : 0) 
                    + 0.989 * (parseFloat(leftovers) === 3 ? 1 : 0) 
                    - 0.994 * (parseFloat(vegetables) === 3 ? 1 : 0) 
                    + 1.545 * parseFloat(anxiety) 
                    + 0.758 * parseFloat(depression) 
                    + 0.679 * parseFloat(gastric_disease) 
                    + 0.928 * parseFloat(family_history);

                // Calculate risk probability
                const risk = Math.exp(logit) / (1 + Math.exp(logit));

                // Determine risk level
                let riskLevel = '';
                if (risk < 0.3) {
                    riskLevel = '低风险';
                } else if (risk < 0.487) {
                    riskLevel = '中风险';
                } else {
                    riskLevel = '高风险';
                }

                // Update risk point position
                const riskPoint = document.getElementById('risk-point');
                const riskText = document.getElementById('risk-text');
                const riskPercentage = (risk * 100).toFixed(2);

                // Set point position (scale: 0% to 100%)
                riskPoint.style.left = `${riskPercentage}%`;

                // Update risk text
                riskText.innerHTML = `
                    <p>发病风险：${riskPercentage}%</p>
                    <p>风险等级：${riskLevel}</p>
                `;
            });
        </script>
    <script>window.parent.postMessage({ action: "ready" }, "*"); 
 
window.console = new Proxy(console, {
  get(target, prop) {
    if (['log', 'warn', 'error'].includes(prop)) {
      return new Proxy(target[prop], {
        apply(fn, thisArg, args) {
          fn.apply(thisArg, args);
          window.parent.postMessage({ action: 'console', 
            type: prop, 
            args: args.map((arg) => {
              try {
                return JSON.stringify(arg).replace(/^["']|["']$/g, '');
              } catch (e) {
                return arg;
              }
            }) 
          }, '*');
        }
      });
    }
    return target[prop];
  }
});
</script></body>
    </html>
